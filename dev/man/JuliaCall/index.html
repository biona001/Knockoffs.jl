<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Calling from R · Knockoffs.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Knockoffs.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../fixed/fixed/">Fixed-X Knockoffs</a></li><li><a class="tocitem" href="../modelX/modelX/">Model-X Knockoffs</a></li><li><a class="tocitem" href="../group/">Group Knockoffs</a></li><li><a class="tocitem" href="../knockoffscreen/knockoffscreen/">KnockoffScreen Knockoffs</a></li><li><a class="tocitem" href="../ghost_knockoffs/">Ghost Knockoffs</a></li><li><a class="tocitem" href="../hmm/hmm/">HMM Knockoffs</a></li><li><a class="tocitem" href="../ipad/">IPAD Knockoffs</a></li><li class="is-active"><a class="tocitem" href>Calling from R</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#Example-1:-Generating-knockoff"><span>Example 1: Generating knockoff</span></a></li><li><a class="tocitem" href="#Example-2:-Running-Lasso"><span>Example 2: Running Lasso</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Calling from R</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Calling from R</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/biona001/Knockoffs.jl/blob/master/docs/src/man/JuliaCall.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><hr/><p>title: &quot;Call Julia code from R&quot; output:    html<em>document:     keep</em>md: true –-</p><h1 id="Calling-from-R"><a class="docs-heading-anchor" href="#Calling-from-R">Calling from R</a><a id="Calling-from-R-1"></a><a class="docs-heading-anchor-permalink" href="#Calling-from-R" title="Permalink"></a></h1><p>This notebook demonstrates how to call Julia code in <code>R</code>. We will use <a href="https://github.com/biona001/Knockoffs.jl">Knockoffs.jl</a> to generate <a href="https://projecteuclid.org/journals/annals-of-statistics/volume-50/issue-1/Powerful-knockoffs-via-minimizing-reconstructability/10.1214/21-AOS2104.full">MVR/ME knockoffs</a> (Minimum Variance-based Reconstructability and Maximum Entropy) in <code>R</code>. </p><p>Interfacing between R and Julia is accomplished by the <code>JuliaCall</code> package</p><ul><li>JuliaCall package repo: https://github.com/Non-Contradiction/JuliaCall</li><li>JuliaCall documentation: https://cran.r-project.org/web/packages/JuliaCall/JuliaCall.pdf</li></ul><p>The following code was tested on Sherlock with <code>julia/1.6.2</code> and <code>R/4.1.2</code>.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>First install <code>JuliaCall</code> like any other R package </p><pre><code class="language-r hljs">install.packages(&quot;JuliaCall&quot;, repos = &quot;http://cran.us.r-project.org&quot;)</code></pre><pre><code class="nohighlight hljs">## 
## The downloaded binary packages are in
## 	/var/folders/vr/7w477ygd2513yzklk5pzsk1r0000gn/T//Rtmp3EMwdk/downloaded_packages</code></pre><p>To use <code>JuliaCall</code> you must have a working installation of Julia. You can download the latest Julia version <a href="https://julialang.org/downloads/">here</a>, or a typical cluster can load Julia with</p><pre><code class="nohighlight hljs">module load julia/1.6.2</code></pre><p>Within Julia, we need to install <code>RCall.jl</code> and <code>Knockoffs.jl</code> packages. Start Julia, and execute the following</p><pre><code class="nohighlight hljs">using Pkg
pkg&quot;add RCall&quot;
pkg&quot;add https://github.com/biona001/Knockoffs.jl&quot;</code></pre><p><strong>Note:</strong> On Stanford cluster, I encountered <code>GLIBCXX_3.4.20 not found</code> error when I call <code>julia_setup()</code> later. To solve this, I added </p><pre><code class="nohighlight hljs">export R_LD_LIBRARY_PATH=/share/software/user/open/julia/1.6.2/lib/julia</code></pre><p>in my <code>~/.bash_profile</code> file. Once we <code>source ~/.bash_profile</code> and restart R, the problem should be resolved. </p><p>To check that installation worked, try loading <code>JuliaCall</code> in R:</p><pre><code class="language-r hljs"># load JuliaCall package
library(JuliaCall)

# tell JuliaCall where is the Julia executable
julia &lt;- julia_setup(JULIA_HOME = &quot;/Applications/Julia-1.8.app/Contents/Resources/julia/bin&quot;)</code></pre><p>Next, within R, also try loading Knockoffs.jl package</p><pre><code class="language-r hljs"># load Knockoffs.jl package
julia_library(&quot;Knockoffs&quot;)</code></pre><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>Below are a few examples of using <code>Knockoffs.jl</code> in R. Obviously, these code can be modified to suit your need. Note that the first call to any Julia function will be slower than subsequent call, because Julia uses JIT (just-in-time) compilation. For larger problems, compilation time becomes negligible. </p><h3 id="Wrapper-1:-generating-knockoffs"><a class="docs-heading-anchor" href="#Wrapper-1:-generating-knockoffs">Wrapper 1: generating knockoffs</a><a id="Wrapper-1:-generating-knockoffs-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapper-1:-generating-knockoffs" title="Permalink"></a></h3><p>Finally, <code>generate_group_ko_with_julia</code> is a wrapper that will solve for group knockoffs using the specified method. </p><ol><li><code>X</code> is the original design matrix</li><li><code>Sigma</code> is covariance matrix</li><li><code>mu</code> is column mean</li><li><code>method</code> can be <code>maxent</code>, <code>sdp</code>, <code>mvr</code>, or <code>equi</code></li><li><code>m</code> is the number of knockoffs to generate per sample (see <a href="http://proceedings.mlr.press/v89/gimenez19b.html">multiple knockoffs paper</a>). </li><li><code>groups</code>: Vector of group membership</li></ol><p>To generate second order knockoffs, simply do not specify <code>Sigma</code> and <code>mu</code>. </p><pre><code class="language-r hljs">generate_group_ko_with_julia &lt;- function(X, Sigma, mu, method, m, groups) {
  # pass variables from R to Julia
  julia_assign(&quot;X&quot;, X)
  julia_assign(&quot;Sigma&quot;, Sigma)
  julia_assign(&quot;mu&quot;, mu)
  julia_assign(&quot;method&quot;, method)
  julia_assign(&quot;m&quot;, m)
  julia_assign(&quot;groups&quot;, groups)
  
  # with Julia, solve group knockoffs problem
  julia_command(&quot;result = modelX_gaussian_group_knockoffs(X, Symbol(method), Int.(groups), mu, Sigma, m=Int(m), verbose=true)&quot;)

  # pull variables from Julia back to R
  Xko &lt;- julia_eval(&quot;result.X̃ &quot;) # the knockoffs
  S &lt;- julia_eval(&quot;result.S&quot;) # the S matrix
  obj &lt;- julia_eval(&quot;result.obj&quot;) # final objective value

  # return
  result &lt;- list(&quot;Xko&quot;=Xko, &quot;S&quot;=S, &quot;obj&quot;=obj)
  return (result)
}</code></pre><h3 id="Wrapper-2:-running-lasso"><a class="docs-heading-anchor" href="#Wrapper-2:-running-lasso">Wrapper 2: running lasso</a><a id="Wrapper-2:-running-lasso-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapper-2:-running-lasso" title="Permalink"></a></h3><p>If one wishes to run Lasso, we have a convenient function <a href="https://github.com/biona001/Knockoffs.jl/blob/group_MVR_ME/src/fit_lasso.jl#L28">fit_lasso</a>. By default, we run with 5 target FDR levels <code>0.01, 0.05, 0.1, 0.25, 0.5</code>, so there are 5 sets of selected variables.</p><pre><code class="language-r hljs">run_group_ko_lasso_with_julia &lt;- function(y, X, Sigma, mu, method, m, groups) {
  # pass variables from R to Julia
  julia_assign(&quot;y&quot;, y)
  julia_assign(&quot;X&quot;, X)
  julia_assign(&quot;Sigma&quot;, Sigma)
  julia_assign(&quot;mu&quot;, mu)
  julia_assign(&quot;method&quot;, method)
  julia_assign(&quot;m&quot;, m)
  julia_assign(&quot;groups&quot;, groups)

  # with Julia, generate group knockoffs then solve lasso
  julia_command(&quot;result = fit_lasso(vec(y), X, mu, Sigma, groups=Int.(groups), method=Symbol(method), m=Int(m))&quot;)

  # pull variables from Julia back to R
  selected &lt;- julia_eval(&quot;result.selected&quot;) # selected variables
  Xko &lt;- julia_eval(&quot;result.ko.X̃ &quot;) # the knockoffs
  S &lt;- julia_eval(&quot;result.ko.S&quot;) # the S matrix
  obj &lt;- julia_eval(&quot;result.ko.obj&quot;) # final objective value

  # return
  result &lt;- list(&quot;selected&quot;=selected, &quot;Xko&quot;=Xko, &quot;S&quot;=S, &quot;obj&quot;=obj)
  return (result)
}</code></pre><h3 id="Wrapper-3:-only-solve-for-S-matrix"><a class="docs-heading-anchor" href="#Wrapper-3:-only-solve-for-S-matrix">Wrapper 3: only solve for S matrix</a><a id="Wrapper-3:-only-solve-for-S-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapper-3:-only-solve-for-S-matrix" title="Permalink"></a></h3><p>Here&#39;s a function that only solves the Knockoff optimization problem and returns the S matrix, given a covariance matrix. </p><ol><li><code>Sigma</code> is covariance matrix</li><li><code>groups</code> is a group membership vector</li><li><code>method</code> can be <code>maxent</code>, <code>sdp</code>, <code>mvr</code>, or <code>equi</code></li><li><code>m</code> is the number of knockoffs to generate per sample. </li></ol><pre><code class="language-r hljs">solve_S_with_julia &lt;- function(Sigma, groups, method, m) {
  # pass Sigma from R to Julia
  julia_assign(&quot;Sigma&quot;, Sigma)
  julia_assign(&quot;groups&quot;, groups)
  julia_assign(&quot;method&quot;, method)
  julia_assign(&quot;m&quot;, m)

  # solve for s vector in Julia (note: one must wrap `Symmetric()` keyword around Sigma)
  julia_command(&quot;S, _, obj = solve_s_group(Symmetric(Sigma), groups, Symbol(method), tol=0.01, m=Int(m))&quot;)

  # put S matrix from Julia back to R
  S &lt;- julia_eval(&quot;S&quot;)

  # return s vector
  return(S)
}</code></pre><h2 id="Example-1:-Generating-knockoff"><a class="docs-heading-anchor" href="#Example-1:-Generating-knockoff">Example 1: Generating knockoff</a><a id="Example-1:-Generating-knockoff-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Generating-knockoff" title="Permalink"></a></h2><p>Let&#39;s simulate a covariance matrix, then solve the group knockoff problem with maximum entropy coordinate descent</p><pre><code class="language-r hljs"># simulate 1000 by 1000 toeplitz covariance matrix in R
n &lt;- 1000 # number of samples
p &lt;- 1000 # number of covariates
m &lt;- 1    # number of knockoffs to generate per feature
Sigma &lt;- toeplitz(0.7^(0:(p-1)))
mu &lt;- rep(0, p)
method &lt;- &quot;maxent&quot;
X &lt;- MASS::mvrnorm(n=n, mu=mu, Sigma=Sigma)

# variables 1-5 are in group 1, then variables 6-10 in group 2...etc
groups = rep(1:200, each = 5)

# call Julia solver
result &lt;- generate_group_ko_with_julia(X, Sigma, mu, method, m, groups)
Xko &lt;- result$Xko
S &lt;- result$S
obj &lt;- result$obj

# print first few entries of S
S[1:5, 1:5]</code></pre><pre><code class="nohighlight hljs">##           [,1]      [,2]      [,3]      [,4]      [,5]
## [1,] 0.8960803 0.5703981 0.3503640 0.2140139 0.0954538
## [2,] 0.5703981 0.8344664 0.5220040 0.3149892 0.1377268
## [3,] 0.3503640 0.5220040 0.7898848 0.4708099 0.1992458
## [4,] 0.2140139 0.3149892 0.4708099 0.7051883 0.2873474
## [5,] 0.0954538 0.1377268 0.1992458 0.2873474 0.4067004</code></pre><h2 id="Example-2:-Running-Lasso"><a class="docs-heading-anchor" href="#Example-2:-Running-Lasso">Example 2: Running Lasso</a><a id="Example-2:-Running-Lasso-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Running-Lasso" title="Permalink"></a></h2><p>Let&#39;s simulate a covariance matrix, design matrix <span>$X$</span>, and response <span>$y$</span>, then solve the group knockoff problem with maximum entropy coordinate descent. To solve the Lasso problem, Knockoffs.jl internally calls Fortran code from the GLMNet library. </p><pre><code class="language-r hljs"># simulate 1000 by 1000 toeplitz covariance matrix in R
n &lt;- 1000 # sample size
p &lt;- 1000 # number of covariates
k &lt;- 10   # number of causal variables
m &lt;- 1    # number of knockoffs to generate per feature
mu &lt;- rep(0, p)
Sigma &lt;- toeplitz(0.4^(0:(p-1)))
method &lt;- &quot;maxent&quot;

# variables 1-5 are in group 1, then variables 6-10 in group 2...etc
groups = rep(1:200, each = 5)

# simulate X, y, beta
X &lt;- MASS::mvrnorm(n=n, mu=mu, Sigma=Sigma)
beta &lt;- sample(c(rnorm(k), rep(0, p-k)))
y &lt;- X %*% beta + rnorm(n)

# call Julia solver
result &lt;- run_group_ko_lasso_with_julia(y, X, Sigma, mu, method, m, groups)
selected &lt;- result$selected
Xko &lt;- result$Xko
S &lt;- result$S
obj &lt;- result$obj

# check selected (here selected has 5 vectors, corresponding to target FDR 0.01, 0.05, 0.1, 0.25, 0.5)
selected[3]</code></pre><pre><code class="nohighlight hljs">##  [1]  14  19  21  38  61  66 123 168 182 183 185</code></pre><p>For sanity check, compare selection to the causal groups</p><pre><code class="language-r hljs">correct_groups &lt;- groups[which(beta != 0)]
correct_groups</code></pre><pre><code class="nohighlight hljs">##  [1]  14  19  38  61  66 123 168 182 183 185</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ipad/">« IPAD Knockoffs</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 5 August 2023 02:26">Saturday 5 August 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
